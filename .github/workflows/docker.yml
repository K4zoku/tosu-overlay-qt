name: Build and publish CI Docker image

on:
  push:
    branches: [ci-testing]
    paths:
      - ".github/workflows/docker.yml"
      - ".github/Dockerfile"

permissions:
  packages: write

concurrency:
  group: docker-${{ github.ref_name }}
  cancel-in-progress: true

jobs:
  docker:
    strategy:
      fail-fast: true
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›’
        uses: actions/checkout@v5
      - name: Build Docker Images
        uses: philips-software/docker-ci-scripts@v4.5.0
        with:
          dockerfile: ./.github/Dockerfile
          image-name: tosu-overlay-build-ci
          tags: latest
          push-branches: main ci-testing
        env:
          REGISTRY_USERNAME: ${{ github.actor }}
          REGISTRY_TOKEN: ${{ github.token }}
          REGISTRY_URL: ghcr.io/k4zoku
          GITHUB_ORGANIZATION: k4zoku